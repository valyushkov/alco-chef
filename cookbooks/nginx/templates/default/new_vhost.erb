#
# Generated by Chef for <%= node[:fqdn] %>
# !!! WARNING !!!
# Local modification will be overwritten.
#
<% unless @options['http_options'].size == 0 %>
  <% @options['http_options'].each do |http_block, http_block_value| %>
<%= http_block %> {
    <% http_block_value.each do |http_k, http_v| %>
<%= http_k %> <%= http_v %>;
   <% end %>
}
  <% end %>
<% end %>

<% unless @options['http_array'].size == 0 %>
  <% @options['http_array'].each do |line| %> 
    <%= line %>;
  <% end %>
<% end %>

<% unless @options['upstreams'].size == 0 %>
  <% @options['upstreams'].each do |u_name, u_opts| %>
upstream <%= u_name %> {
    <% u_opts.each do |u_k, u_v| %>
      <% case u_k
        when 'ups' then %>
          <% u_v.each do |upstream| %>
  <%= upstream %>;
          <% end %>
        <% when 'opts' then %>
          <% u_v.each do |upstream_opts|%>
  <%= upstream_opts %>;
          <% end %>
      <% end %>
    <% end %>
}
  <% end %>
<% end %>

server {
  <% unless @options['vhost_options'].size == 0 %>
    <% @options['vhost_options'].each do |vh_k, vh_v| %>
      <% case vh_k
        when 'listen' then %>
          <% vh_v.each do |listen_addr| %>
  listen <%= listen_addr %>;
          <% end %>
        <% else %>
  <%= vh_k %> <%= vh_v %>;
        <% end %>
    <% end %>
  <% end %>

  <% unless @options['locations'].size == 0 %>
    <% @options['locations'].each do |location_name, location_options| %>
  location <%= location_name %> {
      <% location_options.each do |loc_k, loc_v| %>
        <% case loc_v
          when Array then %>
          <% loc_v.each do |v| %>
    <%= loc_k %> <%= v %>;
          <% end %>
        <% else %>
    <%= loc_k %> <%= loc_v %>;
        <% end %>
      <% end %>
  }

    <% end %>
  <% end %>
}
